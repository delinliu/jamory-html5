var db=function(){var a=window;return{DB:null,dbConnect:function(b,c,d,e){try{return window.openDatabase?(b=b?b:"SHICAI_APP",c=c?c:"1.0",d=d?d:"SHICAI_DB for User Mobile",e=e?e:2097152,a.DB=openDatabase(b,c,d,e),!0):(console.log("Databases are not supported in this browser."),!1)}catch(f){return console.log(2==f?"Invalid database version.":"Unknown error "+f+"."),!1}},dbDefineTable:function(b,c){b&&c||console.log('ERROR: Function "dbCreateTable" tableName or tableField is NULL.');var d,e=[],f=0;for(var g in c)g.toString(),c[g].toString(),e[f]=g,f++;d=e.join(",").toString();var h="CREATE TABLE IF NOT EXISTS "+b+" (";h+=d,h+=")",console.log(h),a.DB.transaction(function(a){a.executeSql(h,[],function(){return!0},function(a,b){return console.log(b),!1})})},dbInsert:function(b,c){if(!c)return console.log("ERROR: FUNCTION dbInsert tableField is NULL"),!1;var d,e,f=[],g=[],h=0;for(var i in c)i.toString(),c[i].toString(),f[h]=i,g[h]=c[i],"number"!=typeof g[h]&&(g[h]='"'+g[h]+'"'),h++;d=f.join(","),e=g.join(",");var j="INSERT INTO "+b+" (";j+=d,j+=") ",j+="VALUES (",j+=e,j+=")",console.log(j),a.DB.transaction(function(a){a.executeSql(j,[],function(){return!0},function(a,b){return console.log(b),!1})})},dbFindAll:function(b,c,d,e){function f(a,b){c(b)}e=e?e:"*",b&&c||console.log('ERROR: Function "dbFindAll" tableName or funName is NULL.');var g="";g+="SELECT "+e+" FROM "+b,console.log(g),a.DB.transaction(function(a){a.executeSql(g,[],f,function(a,b){return d&&d(b),!1})})},dbDelete:function(b,c,d){if(!b||!c)return console.log('ERROR: FUNCTION "dbDelete" tableName or dbParams is NULL'),!1;var e="";e+="DELETE FROM "+b+" WHERE ";var f=new Array,g="",h=0;for(var i in c)"number"!=typeof c[i]&&(c[i]='"'+c[i]+'"'),f[h]=i.toString()+"="+c[i],h++;g=f.join(" AND "),e+=g,a.DB.transaction(function(a){a.executeSql(e)},[],function(a,b){d(b)},function(a,b){return console.log(b),!1}),console.log(e)},dbUpdate:function(b,c,d){var e="UPDATE "+b+" SET ",f=new Array,g="",h=0;for(var i in c)"number"!=typeof c[i]&&(c[i]='"'+c[i]+'"'),f[h]=i.toString()+"="+c[i],h++;if(g=f.join(" , "),e+=g,d){e+=" WHERE ";var j=new Array,k="",l=0;for(var m in d)"number"!=typeof d[m]&&(d[l]='"'+d[m]+'"'),j[l]=m.toString()+"="+d[m],l++;k=j.join(" AND "),e+=k}console.log(e),a.DB.transaction(function(a){a.executeSql(e,[],function(){return!0},function(a,b){return console.log(b),!1})}),console.log(e)},dbTruncate:function(b){function c(b){a.DB.transaction(function(a){a.executeSql("DELETE TABLE "+b)},[],function(){return console.log("DELETE TABLE "+b),!0},function(a,b){return console.log(b),!1})}return b?void c(b):(console.log("ERROR:Table Name is NULL"),!1)},dbDrop:function(b){function c(b){a.DB.transaction(function(a){a.executeSql("DROP TABLE "+b)},[],function(){return console.log("DROP TABLE "+b),!0},function(a,b){return console.log(b),!1})}return b?void c(b):(console.log("ERROR:Table Name is NULL"),!1)}}}(),Main=function(){function a(){return Math.random()>.5?-1:1}function b(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function c(a,c){b(a,c)||(a.className+=" "+c)}function d(a,c){if(b(a,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)");a.className=a.className.replace(d,"")}}function e(){function a(b){b>4||(d(l("btn"+b),"btn-hide"),setTimeout(function(){a(b+1)},100))}a(1)}function f(){function a(b){return b>4?void i():(c(l("btn"+b),"btn-hide"),void setTimeout(function(){a(b+1)},100))}a(1),g()}function g(){r("audio/right.mp3"),p.add()}function h(){c(o,"err"),r("audio/err.mp3"),setTimeout(function(){d(o,"err")},100),p.clear()}function i(){for(var b=parseInt(Math.random()*n),c=parseInt(3*Math.random()),d=0;d==c;)d=parseInt(3*Math.random());for(var f=0;f==c||f==d;)f=parseInt(3*Math.random());var g={};g[b]=!0;for(var h=parseInt(Math.random()*n);g[h];)h=parseInt(Math.random()*n);g[h]=!0;for(var i=parseInt(Math.random()*n);g[i];)i=parseInt(Math.random()*n);g[i]=!0;for(var j=parseInt(Math.random()*n);g[j];)j=parseInt(Math.random()*n);g[j]=!0;var k=[m[b][d],m[h][d],m[i][d],m[j][d]];k=k.sort(a);for(var p=0,q=k.length;q>p;p++)l("btn"+(p+1)).innerHTML=k[p];o.innerHTML=m[b][c],o.setAttribute("data-answer",m[b][d]),o.setAttribute("data-val1",m[b][c]),o.setAttribute("data-val2",m[b][f]),e()}function j(){for(var a=document.getElementsByClassName("btn"),b=0,c=a.length;c>b;b++)a[b].onclick=function(){console.log(this);var a=this.innerHTML;a==o.getAttribute("data-answer")?f():h()};o.onclick=function(){var a=o.getAttribute("data-val1"),b=o.getAttribute("data-val2"),c=o.innerHTML;o.innerHTML=c==a?b:a}}function k(){document.addEventListener("touchstart",function(){},!1),i(),j(),p.init()}var l=function(a){return document.getElementsByClassName(a)[0]},m=[["あ","ア","a"],["い","イ","i"],["う","ウ","u"],["え","エ","e"],["お","オ","o"],["か","カ","ka"],["き","キ","ki"],["く","ク","ku"],["け","ケ","ke"],["こ","コ","ko"],["さ","サ","sa"],["し","シ","shi"],["す","ス","su"],["せ","セ","se"],["そ","ソ","so"],["た","タ","ta"],["ち","チ","chi"],["つ","ツ","tsu"],["て","テ","te"],["と","ト","to"],["な","ナ","na"],["に","ニ","ni"],["ぬ","ヌ","nu"],["ね","ネ","ne"],["の","ノ","no"],["は","ハ","ha"],["ひ","ヒ","hi"],["ふ","フ","fu"],["へ","ヘ","he"],["ほ","ホ","ho"],["ま","マ","ma"],["み","ミ","mi"],["む","ム","mu"],["め","メ","me"],["も","モ","mo"],["や","ヤ","ya"],["い","イ","i"],["ゆ","ユ","yu"],["え","エ","e"],["よ","ヨ","yo"],["ら","ラ","ra"],["り","リ","ri"],["る","ル","ru"],["れ","レ","re"],["ろ","ロ","ro"],["わ","ワ","wa"],["い","イ","i"],["う","ウ","u"],["え","エ","e"],["を","ヲ","wo"],["ん","ン","n"]],n=m.length,o=document.getElementsByClassName("round")[0],p={key:"score",bestKey:"best",dbName:"js_db",tableName:"js_table",add:function(){var a=this;db.dbFindAll(a.tableName,function(b){var c={},d=b.rows.item(0).score,e=parseInt(d)+1;l("score").innerHTML=e,c[a.key]=e,c[a.bestKey]=b.rows.item(0).best;var f=parseInt(l("best-val").innerHTML);e>f&&(c[a.bestKey]=e,l("best-val").innerHTML=e),db.dbUpdate(a.tableName,c,null,function(a){console.log(a)})},function(){})},clear:function(){var a=this,b={};b[a.key]=0,db.dbUpdate(a.tableName,b,null,function(a){console.log(a)}),l("score").innerHTML=0},init:function(){var a=this;db.dbConnect(a.dbName);var b={};b[a.key]=0,b[this.bestKey]=0,db.dbFindAll(a.tableName,function(a){l("score").innerHTML=a.rows.item(0).score,l("best-val").innerHTML=a.rows.item(0).best},function(){db.dbDefineTable(a.tableName,b),db.dbInsert(a.tableName,b,null,function(){})})}},q=!1,r=function(a){if("undefined"!=typeof device){alert(3),"Android"==device.platform&&console.log(a);var b=new Media(a,function(){b.release()},function(a){alert("error playing sound: "+JSON.stringify(a))});b.play()}else"undefined"!=typeof Audio?q?(_audio.src=a,_audio.play()):(_audio=new Audio(a),_audio.play(),q=!0):alert("no sound API to play: "+a)};return{init:k}}();